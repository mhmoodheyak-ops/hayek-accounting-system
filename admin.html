<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>HAYEK SPOT — لوحة الأمن</title>

  <link rel="stylesheet" href="./style.css?v=9004" />

  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- ✅ PDF تصوير HTML -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- Config -->
  <script src="./config.js?v=9004"></script>
</head>

<body class="app-body">
  <div class="app-wrap">

    <div class="card header-card">
      <div class="header-title">لوحة الأمن</div>
      <div class="header-sub">
        إدارة المستخدمين والفواتير — مع قفل الجهاز الواحد (device_id)
      </div>
      <div id="statusLine" class="status-pill">غير مسجل</div>
    </div>

    <div class="grid-2">
      <!-- تسجيل الدخول -->
      <div class="card">
        <div class="card-title">تسجيل الدخول (Admin)</div>

        <div class="form-grid">
          <div class="field">
            <label>اسم المستخدم</label>
            <input id="adminUser" type="text" value="admin" autocomplete="username" />
          </div>
          <div class="field">
            <label>كلمة السر</label>
            <input id="adminPass" type="password" value="" autocomplete="current-password" />
          </div>
        </div>

        <div class="btn-row">
          <button id="btnAdminLogin" class="btn primary">تسجيل دخول</button>
          <button id="btnAdminLogout" class="btn">تسجيل خروج</button>
        </div>

        <div id="adminStatePill" class="status-pill ok" style="margin-top:10px; display:none;"></div>
      </div>

      <!-- إدارة المستخدمين -->
      <div class="card">
        <div class="card-title">إدارة المستخدمين</div>

        <div class="form-grid">
          <div class="field">
            <label>اسم مستخدم جديد</label>
            <input id="newUsername" type="text" placeholder="مثال: محمود" />
          </div>
          <div class="field">
            <label>كلمة السر</label>
            <input id="newPassword" type="text" value="1234" />
          </div>
          <div class="field">
            <label>صلاحية</label>
            <select id="newRole">
              <option value="user">مستخدم</option>
              <option value="admin">Admin</option>
            </select>
          </div>
        </div>

        <div class="btn-row">
          <button id="btnAddUser" class="btn success">إضافة</button>
          <button id="btnRefreshUsers" class="btn">تحديث قائمة المستخدمين</button>
          <div class="pill" id="usersCount">عدد المستخدمين: 0</div>
        </div>

        <div class="users-list" id="usersList"></div>
      </div>
    </div>

    <!-- الفواتير -->
    <div class="card">
      <div class="card-title">الفواتير</div>

      <div class="form-grid">
        <div class="field">
          <label>اختر المستخدم</label>
          <select id="pickUser">
            <option value="">— اختر —</option>
          </select>
        </div>

        <div class="field">
          <label>الحالة</label>
          <select id="pickStatus">
            <option value="">الكل</option>
            <option value="open">مفتوحة</option>
            <option value="closed">منتهية</option>
          </select>
        </div>

        <div class="field">
          <label>من تاريخ</label>
          <input id="fromDate" type="date" />
        </div>

        <div class="field">
          <label>إلى تاريخ</label>
          <input id="toDate" type="date" />
        </div>
      </div>

      <div class="btn-row">
        <button id="btnToday" class="btn">فواتير اليوم</button>
        <button id="btnLast7" class="btn">آخر 7 أيام</button>
        <button id="btnLoadInvoices" class="btn primary">اعرض الفواتير</button>
        <div class="pill" id="invCount">عدد النتائج: 0</div>
      </div>

      <div class="form-grid" style="margin-top:12px;">
        <div class="field">
          <label>قائمة الفواتير</label>
          <select id="invoiceSelect">
            <option value="">— اختر فاتورة —</option>
          </select>
        </div>

        <div class="btn-row" style="align-items:end; gap:10px;">
          <button id="btnOpenInvoice" class="btn">فتح</button>
          <button id="btnExportInvoicePdf" class="btn success">تصدير PDF</button>
        </div>
      </div>

      <!-- معاينة -->
      <div id="invoicePreview" class="invoice-preview"></div>
    </div>

  </div>

  <script src="./admin.js?v=9004"></script>
</body>
</html>
