<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>HAYEK SPOT — لوحة الأمن</title>

  <link rel="stylesheet" href="./style.css?v=9002" />

  <!-- Supabase (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- ✅ PDF عربي مضمون (HTML -> PDF) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- Config -->
  <script src="./config.js?v=9002"></script>
</head>

<body class="app-body">
  <div class="app-wrap">

    <div class="card header-card">
      <div class="header-title">لوحة الأمن</div>
      <div class="header-sub">إدارة المستخدمين والفواتير — مع قفل الجهاز الواحد (device_id) للأمن.</div>
      <div class="pill" id="statusLine">الحالة: —</div>
    </div>

    <div class="grid">
      <!-- Admin Login -->
      <div class="card">
        <div class="card-title">تسجيل الدخول (Admin)</div>

        <div class="row">
          <div class="field">
            <label>اسم المستخدم</label>
            <input id="adminUser" type="text" autocomplete="username" value="admin" />
          </div>
          <div class="field">
            <label>كلمة السر</label>
            <input id="adminPass" type="password" autocomplete="current-password" />
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="btnAdminLogin">تسجيل دخول</button>
          <button class="btn" id="btnAdminLogout">تسجيل خروج</button>
          <div class="pill ok" id="adminStatePill">غير مسجل</div>
        </div>

        <div class="msg" id="adminMsg"></div>
      </div>

      <!-- Add user -->
      <div class="card">
        <div class="card-title">إدارة المستخدمين</div>

        <div class="row">
          <div class="field">
            <label>اسم مستخدم جديد</label>
            <input id="newUsername" type="text" placeholder="مثال: محمود" />
          </div>
          <div class="field">
            <label>كلمة السر</label>
            <input id="newPassword" type="text" placeholder="1234" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>صلاحية</label>
            <select id="newRole">
              <option value="user" selected>مستخدم</option>
              <option value="admin">Admin</option>
            </select>
          </div>

          <div class="field">
            <label>عدد المستخدمين</label>
            <div class="pill" id="usersCount">—</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn green" id="btnAddUser">إضافة</button>
          <button class="btn" id="btnRefreshUsers">تحديث قائمة المستخدمين</button>
          <div class="pill" id="pickedUserLabel">المستخدم المحدد للفواتير: —</div>
        </div>
      </div>
    </div>

    <!-- Users List -->
    <div class="card">
      <div class="card-title">قائمة المستخدمين</div>

      <div class="users-list" id="usersList"></div>
    </div>

    <!-- Invoices -->
    <div class="card">
      <div class="card-title">فلاتر الفواتير</div>

      <div class="row">
        <div class="field">
          <label>من تاريخ</label>
          <input id="fromDate" type="date" />
        </div>
        <div class="field">
          <label>إلى تاريخ</label>
          <input id="toDate" type="date" />
        </div>
        <div class="field">
          <label>الحالة</label>
          <select id="pickStatus">
            <option value="all" selected>الكل</option>
            <option value="open">مفتوحة</option>
            <option value="closed">منتهية</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnToday">فواتير اليوم</button>
        <button class="btn" id="btnLast7">فواتير آخر 7 أيام</button>
        <button class="btn primary" id="btnLoadInvoices">جلب الفواتير</button>
        <div class="pill" id="invCount">عدد النتائج: 0</div>
      </div>

      <div class="row">
        <div class="field">
          <label>قائمة الفواتير (اختر فاتورة لفتحها)</label>
          <select id="invoiceSelect">
            <option value="">— لا يوجد —</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="btnOpenInvoice">فتح الفاتورة</button>
        <button class="btn green" id="btnExportInvoicePdf">تصدير PDF</button>
      </div>

      <div class="split">
        <div class="preview-card">
          <div class="preview-title">معاينة الفاتورة</div>
          <div id="invoicePreview"></div>
        </div>
      </div>
    </div>

  </div>

  <script src="./admin.js?v=9002"></script>
</body>
</html>
