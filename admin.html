<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HAYEK SPOT — لوحة الإدارة</title>

  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#071820" />

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- PDF -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- Config + Auth -->
  <script src="./config.js?v=3"></script>
  <script src="./auth.js?v=3"></script>

  <link rel="stylesheet" href="./style.css?v=3" />
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <span class="dot online" id="netDot"></span>
      <div class="titles">
        <div class="title">HAYEK SPOT</div>
        <div class="subtitle">لوحة الإدارة — الفواتير + المستخدمين</div>
      </div>
    </div>

    <div class="toolsGrid">
      <button class="btn primary" id="btnRefresh">تحديث</button>
      <button class="btn" id="btnLogout">خروج</button>
      <span class="pill" id="adminLabel">admin</span>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="tabs">
        <button class="tab active" data-tab="invoices">الفواتير</button>
        <button class="tab" data-tab="users">المستخدمين</button>
      </div>

      <!-- ====== الفواتير ====== -->
      <div id="tab-invoices" class="tabpane">
        <div class="grid2">
          <div class="card" style="margin:0">
            <div class="field">
              <label>بحث</label>
              <input id="qInvoices" placeholder="بحث: اسم المستخدم / اسم الزبون / رقم الفاتورة (آخر 6 أرقام)..." />
              <div class="hint subtle">يفضل البحث برقم الفاتورة (آخر 6 أرقام) أو اسم المستخدم.</div>
            </div>

            <div class="btnRow">
              <button class="btn" id="btnLoadInvoices">تحميل الفواتير</button>
              <button class="btn" id="btnDownloadInvoicesCSV">تحميل الفواتير CSV</button>
            </div>

            <div class="toast" id="toastInv"></div>

            <div class="tableWrap" style="margin-top:12px">
              <table class="tbl" id="tblInvoices">
                <thead>
                  <tr>
                    <th>التاريخ</th>
                    <th>المستخدم</th>
                    <th>الزبون</th>
                    <th>الإجمالي</th>
                    <th>الحالة</th>
                    <th>رقم</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody id="invoicesBody"></tbody>
              </table>
            </div>
          </div>

          <div class="card" style="margin:0">
            <h3 class="h3">تفاصيل الفاتورة</h3>

            <div class="grid2" style="grid-template-columns:1fr 1fr">
              <div class="pill">رقم الفاتورة: <span id="dId" style="margin-inline-start:8px">—</span></div>
              <div class="pill">الحالة: <span id="dStatus" style="margin-inline-start:8px">—</span></div>
              <div class="pill">المستخدم: <span id="dUser" style="margin-inline-start:8px">—</span></div>
              <div class="pill">الزبون: <span id="dCust" style="margin-inline-start:8px">—</span></div>
              <div class="pill">الإجمالي: <span id="dTotal" style="margin-inline-start:8px">—</span></div>
              <div class="pill">التاريخ: <span id="dDate" style="margin-inline-start:8px">—</span></div>
            </div>

            <div class="btnRow" style="margin-top:12px">
              <button class="btn primary" id="btnLoadOps" disabled>العمليات</button>
              <button class="btn" id="btnMakePDF" disabled>PDF</button>
            </div>

            <div class="toast" id="toastOps"></div>

            <div class="tableWrap" style="margin-top:12px">
              <table class="tbl">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>الوقت</th>
                    <th>البيان</th>
                    <th>العملية</th>
                    <th>النتيجة</th>
                  </tr>
                </thead>
                <tbody id="opsBody"></tbody>
              </table>
            </div>

            <div class="totalBox" style="margin-top:12px">
              <span class="totalLabel">إجمالي الكشف:</span>
              <span class="totalValue num" id="opsTotal">0</span>
            </div>

            <div class="pdfStage" id="pdfStage"></div>

            <div class="footerNote">
              تم تطوير النظام من قبل شركة الحايك — 05510217646
            </div>
          </div>
        </div>
      </div>

      <!-- ====== المستخدمين ====== -->
      <div id="tab-users" class="tabpane hidden">
        <div class="grid2">
          <div class="card" style="margin:0">
            <div class="field">
              <label>بحث</label>
              <input id="qUsers" placeholder="بحث: اسم المستخدم..." />
            </div>

            <div class="btnRow">
              <button class="btn" id="btnLoadUsers">تحميل المستخدمين</button>
              <button class="btn primary" id="btnAddUser">+ مستخدم</button>
            </div>

            <div class="toast" id="toastUsers"></div>

            <div class="tableWrap" style="margin-top:12px">
              <table class="tbl">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>اسم المستخدم</th>
                    <th>الحالة</th>
                    <th>أدمن</th>
                    <th>جهاز</th>
                    <th>آخر ظهور</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody id="usersBody"></tbody>
              </table>
            </div>
          </div>

          <div class="card" style="margin:0">
            <h3 class="h3">إضافة/تعديل مستخدم</h3>

            <div class="field">
              <label>اسم المستخدم</label>
              <input id="u_name" placeholder="مثال: user1" />
            </div>

            <div class="field">
              <label>كلمة السر</label>
              <input id="u_pass" placeholder="1234" />
            </div>

            <div class="toggles" style="margin-top:10px">
              <label class="chk"><input type="checkbox" id="u_is_admin"> أدمن</label>
              <label class="chk"><input type="checkbox" id="u_blocked"> محظور</label>
            </div>

            <div class="btnRow" style="margin-top:12px">
              <button class="btn primary" id="btnSaveUser">حفظ</button>
              <button class="btn danger" id="btnResetDevice">مسح الجهاز</button>
              <button class="btn" id="btnClearForm">تفريغ</button>
            </div>

            <div class="toast" id="toastUserForm"></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="./admin.js?v=3"></script>
</body>
</html>
