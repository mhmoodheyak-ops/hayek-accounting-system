<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>HAYEK SPOT — لوحة الأمن</title>

  <!-- Supabase (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- html2pdf (اختياري للتصدير) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root{
      --bg:#0b1116;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.04);
      --line:rgba(255,255,255,.10);
      --txt:#e8eef5;
      --muted:#9db0c3;
      --green:#2ecc71;
      --red:#ff5d5d;
      --yellow:#f1c40f;
      --blue:#4aa3ff;
      --shadow:0 18px 50px rgba(0,0,0,.45);
      --radius:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 70% -10%, rgba(0,255,170,.18), transparent 60%),
                  radial-gradient(900px 600px at 0% 20%, rgba(74,163,255,.14), transparent 55%),
                  var(--bg);
      color:var(--txt);
      font-family: system-ui, -apple-system, Segoe UI, Tahoma, Arial, sans-serif;
      padding:18px;
    }
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      margin-bottom:14px;
    }
    .brand{
      display:flex; flex-direction:column; gap:6px;
    }
    .brand h1{
      margin:0; font-size:20px; letter-spacing:.3px;
    }
    .brand .sub{color:var(--muted); font-size:12px}
    .pill{
      padding:10px 14px; border-radius:999px;
      background:rgba(46,204,113,.18);
      border:1px solid rgba(46,204,113,.35);
      color:#c9ffdf; font-weight:700;
      min-width:110px; text-align:center;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
      overflow:hidden;
    }

    .card h2{
      margin:0 0 10px 0;
      font-size:16px;
      color:#dff6ff;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .muted{color:var(--muted); font-size:12px}

    .row{display:flex; gap:10px; flex-wrap:wrap}
    .field{
      flex:1 1 160px;
      display:flex; flex-direction:column; gap:6px;
    }
    label{font-size:12px; color:var(--muted)}
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      color: var(--txt);
      outline:none;
    }
    input::placeholder{color:rgba(157,176,195,.65)}
    .btn{
      padding:12px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--txt);
      cursor:pointer;
      font-weight:700;
      transition:.15s;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn:active{transform: translateY(0px)}
    .btn.green{background: rgba(46,204,113,.16); border-color: rgba(46,204,113,.35)}
    .btn.red{background: rgba(255,93,93,.16); border-color: rgba(255,93,93,.35)}
    .btn.yellow{background: rgba(241,196,15,.14); border-color: rgba(241,196,15,.35)}
    .btn.blue{background: rgba(74,163,255,.14); border-color: rgba(74,163,255,.35)}
    .btn.block{width:100%}

    table{
      width:100%;
      border-collapse: collapse;
      margin-top:12px;
      overflow:hidden;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      text-align:right;
      font-size:13px;
      vertical-align:middle;
    }
    th{color:#cfe7ff; font-size:12px; background: rgba(255,255,255,.05)}
    tr:hover td{background: rgba(255,255,255,.03)}

    .actions{display:flex; gap:8px; justify-content:flex-start; flex-wrap:wrap}
    .tag{
      display:inline-flex; align-items:center; justify-content:center;
      padding:6px 10px; border-radius:999px; font-size:12px; font-weight:800;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }
    .tag.ok{border-color: rgba(46,204,113,.35); background: rgba(46,204,113,.14)}
    .tag.bad{border-color: rgba(255,93,93,.35); background: rgba(255,93,93,.14)}

    .sep{height:1px; background: rgba(255,255,255,.10); margin:12px 0}
    .notice{font-size:12px; color:var(--muted); line-height:1.7}
    .warn{color:#ffd08a}
    .ok{color:#b9ffd2}

    /* printable area */
    #printable-area{
      background:white;
      color:#111;
      padding:16px;
      border-radius:14px;
      margin-top:12px;
      display:none;
    }
    #printable-area table{border:1px solid #ddd}
    #printable-area th{background:#f2f2f2; color:#111}
    #printable-area td,#printable-area th{border-bottom:1px solid #eee}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <h1>لوحة الأمن — HAYEK SPOT</h1>
      <div class="sub">إدارة المستخدمين + فواتير متعددة + عرض/طباعة PDF</div>
    </div>
    <div id="pill" class="pill">...</div>
  </div>

  <div class="grid">

    <!-- USERS -->
    <div class="card">
      <h2>إدارة المستخدمين <span class="muted">إضافة + حظر/فك + حذف + بحث + Paging</span></h2>

      <div class="row">
        <div class="field">
          <label>اسم المستخدم</label>
          <input id="newUsername" placeholder="مثال: محمود" />
        </div>
        <div class="field">
          <label>كلمة السر</label>
          <input id="newPass" placeholder="مثال: 123456" />
        </div>
        <div class="field" style="max-width:160px">
          <label>صلاحية</label>
          <select id="newIsAdmin">
            <option value="false">مستخدم</option>
            <option value="true">أدمن</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn yellow" id="btnGenPass">توليد كلمة سر</button>
        <button class="btn green" id="btnSaveUser">حفظ المستخدم</button>
        <button class="btn" id="btnRefreshUsers">تحديث القائمة</button>
      </div>

      <div class="row" style="margin-top:10px">
        <div class="field">
          <label>بحث عن مستخدم (جزء من الاسم)</label>
          <input id="searchUser" placeholder="اكتب جزء من الاسم..." />
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn" id="btnPrevUsers">السابق</button>
        <button class="btn" id="btnNextUsers">التالي</button>
      </div>

      <div class="sep"></div>

      <table>
        <thead>
          <tr>
            <th style="width:28%">الاسم</th>
            <th style="width:18%">كلمة السر</th>
            <th style="width:12%">Admin</th>
            <th style="width:12%">الحالة</th>
            <th>إجراءات</th>
          </tr>
        </thead>
        <tbody id="usersTbody"></tbody>
      </table>

      <div class="notice" style="margin-top:10px">
        <div class="ok">✓ الحظر يمنع الدخول (حسب منطقك بصفحة المستخدم).</div>
        <div class="warn">⚠ لا تشارك مفاتيح Supabase مع أي شخص.</div>
      </div>
    </div>

    <!-- INVOICES -->
    <div class="card">
      <h2>فواتير متعددة للمستخدم <span class="muted">قائمة فواتير لكل مستخدم + فتح/حذف</span></h2>

      <div class="row">
        <div class="field">
          <label>اختر المستخدم</label>
          <select id="userSelect">
            <option value="">— اختر المستخدم —</option>
          </select>
        </div>
        <div class="field">
          <label>من تاريخ</label>
          <input id="fromDate" type="date" />
        </div>
        <div class="field">
          <label>إلى تاريخ</label>
          <input id="toDate" type="date" />
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn blue" id="btnInvoicesRefresh">تحديث قائمة الفواتير</button>
        <button class="btn" id="btnLast7">آخر 7 أيام</button>
        <button class="btn" id="btnToday">اليوم</button>
        <button class="btn" id="btnClearDates">مسح التواريخ</button>
      </div>

      <div class="row" style="margin-top:10px">
        <div class="field">
          <label>اختر فاتورة (حسب التاريخ)</label>
          <select id="invoiceSelect">
            <option value="">— اختر فاتورة —</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn green" id="btnOpenInvoice">فتح الفاتورة المختارة</button>
        <button class="btn red" id="btnDeleteInvoice">حذف الفاتورة المختارة</button>
        <button class="btn" id="btnPrintPdf">تصدير / طباعة PDF</button>
      </div>

      <div class="sep"></div>

      <h2 style="margin-top:0">تفاصيل الفاتورة <span class="muted">العمليات داخل invoice_id فقط</span></h2>

      <div class="row">
        <div class="field" style="max-width:240px">
          <label>المجموع العام</label>
          <input id="grandTotal" readonly value="0" />
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th style="width:25%">الوقت</th>
            <th style="width:35%">البيان</th>
            <th style="width:20%">العملية</th>
            <th style="width:20%">النتيجة</th>
          </tr>
        </thead>
        <tbody id="opsTbody"></tbody>
      </table>

      <div id="printable-area">
        <h3 style="margin:0 0 10px 0">فاتورة — HAYEK SPOT</h3>
        <div id="printMeta" style="font-size:12px; color:#333; margin-bottom:8px"></div>
        <div id="printTotal" style="font-weight:800; margin-bottom:10px"></div>
        <div id="printTable"></div>
      </div>

      <div class="notice" style="margin-top:10px">
        <div class="ok">✓ كل فاتورة مستقلة (id). الفتح والحذف يعتمد على invoice_id.</div>
        <div class="warn">⚠ إذا عندك عمليات قديمة بدون invoice_id ستظهر فقط إذا عملت لها ترحيل لاحقاً.</div>
      </div>
    </div>

  </div>

<script>
/* =======================
   CONFIG (غيّر فقط هنا)
   ======================= */
const SUPABASE_URL = "https://itidwqvyrjydmegjzuvn.supabase.co";   // مثال: https://xxxx.supabase.co
const SUPABASE_KEY = "sb_publishable_j4ubD1htJvuMvOWUKC9w7g_mwVQzHb_"; // anon/publishable key

// علامة إصدار للتأكد أنك فتحت النسخة الصحيحة
console.log("HAYEK ADMIN single-file build v999");

/* =======================
   Helpers
   ======================= */
const $ = (id) => document.getElementById(id);

function setPill(ok, msg){
  const pill = $("pill");
  pill.textContent = msg || (ok ? "مفتوح" : "مغلق");
  pill.style.background = ok ? "rgba(46,204,113,.18)" : "rgba(255,93,93,.18)";
  pill.style.borderColor = ok ? "rgba(46,204,113,.35)" : "rgba(255,93,93,.35)";
  pill.style.color = ok ? "#c9ffdf" : "#ffd1d1";
}

function nowISODate(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}

function daysAgoISO(n){
  const d = new Date();
  d.setDate(d.getDate()-n);
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}

function fmtDateTime(ts){
  try{
    const d = new Date(ts);
    return d.toLocaleString("ar-EG", { hour12:true });
  }catch(e){
    return String(ts||"");
  }
}

function safeNum(x){
  const n = Number(x);
  return Number.isFinite(n) ? n : 0;
}

function vibrate(ms=20){
  try{ if(navigator.vibrate) navigator.vibrate(ms); }catch(e){}
}

function requireUser(){
  const u = $("userSelect").value;
  if(!u){ alert("اختر مستخدم أولاً"); return null; }
  return u;
}
function requireInvoice(){
  const id = $("invoiceSelect").value;
  if(!id){ alert("اختر فاتورة أولاً"); return null; }
  return id;
}

/* =======================
   Supabase client
   ======================= */
let client = null;
function initClient(){
  try{
    if(!SUPABASE_URL.startsWith("http")) throw new Error("SUPABASE_URL غير صحيح");
    client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    setPill(true, "مفتوح");
  }catch(e){
    console.error(e);
    setPill(false, "مغلق");
    alert("خطأ إعداد Supabase: تأكد من SUPABASE_URL و SUPABASE_KEY");
  }
}

/* =======================
   State
   ======================= */
const state = {
  usersPage: 0,
  pageSize: 15,
  lastUsers: [],
};

/* =======================
   USERS CRUD
   Table: app_users (username, pass, is_admin, blocked, created_at)
   ======================= */
function genPassword(){
  const p = Math.floor(100000 + Math.random()*900000);
  $("newPass").value = String(p);
  vibrate(10);
}

async function loadUsers(){
  if(!client) return;

  const search = ($("searchUser").value || "").trim();
  let q = client
    .from("app_users")
    .select("id, username, pass, is_admin, blocked, created_at")
    .order("created_at", { ascending: false })
    .range(state.usersPage * state.pageSize, state.usersPage * state.pageSize + state.pageSize - 1);

  if(search){
    // ilike on username
    q = q.ilike("username", `%${search}%`);
  }

  const { data, error } = await q;
  if(error){
    console.error(error);
    setPill(false, "مغلق");
    alert("خطأ تحميل المستخدمين: " + error.message);
    return;
  }

  setPill(true, "مفتوح");
  state.lastUsers = data || [];
  renderUsersTable(state.lastUsers);
  fillUserSelect(state.lastUsers);
}

function renderUsersTable(users){
  const tb = $("usersTbody");
  tb.innerHTML = "";
  (users || []).forEach(u=>{
    const tr = document.createElement("tr");

    const tdName = document.createElement("td");
    tdName.textContent = u.username;

    const tdPass = document.createElement("td");
    tdPass.textContent = u.pass;

    const tdAdmin = document.createElement("td");
    tdAdmin.innerHTML = u.is_admin ? `<span class="tag ok">YES</span>` : `<span class="tag">NO</span>`;

    const tdState = document.createElement("td");
    tdState.innerHTML = u.blocked ? `<span class="tag bad">محظور</span>` : `<span class="tag ok">مفعل</span>`;

    const tdAct = document.createElement("td");
    tdAct.className = "actions";
    const btnPick = document.createElement("button");
    btnPick.className = "btn";
    btnPick.textContent = "اختيار";
    btnPick.onclick = async () => {
      $("userSelect").value = u.username;
      await loadInvoicesForUser();
      window.scrollTo({ top: 0, behavior:"smooth" });
      vibrate(15);
    };

    const btnToggle = document.createElement("button");
    btnToggle.className = "btn yellow";
    btnToggle.textContent = u.blocked ? "فك الحظر" : "حظر";
    btnToggle.onclick = () => setBlocked(u.username, !u.blocked);

    const btnDel = document.createElement("button");
    btnDel.className = "btn red";
    btnDel.textContent = "حذف";
    btnDel.onclick = () => deleteUser(u.username);

    tdAct.append(btnPick, btnToggle, btnDel);

    tr.append(tdName, tdPass, tdAdmin, tdState, tdAct);
    tb.appendChild(tr);
  });
}

function fillUserSelect(users){
  const sel = $("userSelect");
  const current = sel.value;
  sel.innerHTML = `<option value="">— اختر المستخدم —</option>`;
  (users || []).forEach(u=>{
    const opt = document.createElement("option");
    opt.value = u.username;
    opt.textContent = u.username;
    sel.appendChild(opt);
  });
  if(current) sel.value = current;
}

async function addUser(){
  if(!client) return;

  const username = ($("newUsername").value || "").trim();
  const pass = ($("newPass").value || "").trim();
  const is_admin = $("newIsAdmin").value === "true";

  if(!username || !pass){
    alert("اكتب اسم المستخدم وكلمة السر");
    return;
  }

  const { error } = await client
    .from("app_users")
    .insert({ username, pass, is_admin, blocked:false });

  if(error){
    console.error(error);
    alert("خطأ بالحفظ: " + error.message);
    return;
  }

  $("newUsername").value = "";
  $("newPass").value = "";
  alert("تم حفظ المستخدم ✅");
  vibrate(20);
  await loadUsers();
}

async function setBlocked(username, blocked){
  if(!client) return;
  const { error } = await client
    .from("app_users")
    .update({ blocked })
    .eq("username", username);

  if(error){
    console.error(error);
    alert("خطأ: " + error.message);
    return;
  }
  vibrate(15);
  await loadUsers();
}

async function deleteUser(username){
  if(!client) return;
  if(!confirm(`تأكيد حذف المستخدم "${username}" ؟`)) return;

  const { error } = await client
    .from("app_users")
    .delete()
    .eq("username", username);

  if(error){
    console.error(error);
    alert("خطأ: " + error.message);
    return;
  }
  vibrate(20);
  await loadUsers();
}

/* =======================
   INVOICES
   Tables:
   - app_invoices(id, username, device_id, total, created_at)
   - app_operations(..., username, invoice_id, created_at)
   ======================= */
function invoiceLabel(inv){
  const dt = fmtDateTime(inv.created_at);
  const t = safeNum(inv.total).toFixed(2);
  return `${dt} — مجموع: ${t}`;
}

async function loadInvoicesForUser(){
  if(!client) return;

  const username = requireUser();
  if(!username) return;

  const from = $("fromDate").value;
  const to = $("toDate").value;

  let q = client
    .from("app_invoices")
    .select("id, username, total, created_at")
    .eq("username", username)
    .order("created_at", { ascending:false });

  // فلترة بالتاريخ (اختياري)
  if(from) q = q.gte("created_at", from + "T00:00:00");
  if(to)   q = q.lte("created_at",   to   + "T23:59:59");

  const { data, error } = await q;
  if(error){
    console.error(error);
    alert("خطأ تحميل الفواتير: " + error.message);
    return;
  }

  const sel = $("invoiceSelect");
  sel.innerHTML = `<option value="">— اختر فاتورة —</option>`;

  (data || []).forEach(inv=>{
    const opt = document.createElement("option");
    opt.value = inv.id;
    opt.textContent = invoiceLabel(inv);
    sel.appendChild(opt);
  });

  // امسح التفاصيل السابقة
  $("opsTbody").innerHTML = "";
  $("grandTotal").value = "0";

  vibrate(10);
}

async function openSelectedInvoice(){
  if(!client) return;

  const username = requireUser();
  if(!username) return;

  const invoiceId = requireInvoice();
  if(!invoiceId) return;

  // اجلب العمليات الخاصة بهذه الفاتورة فقط
  const { data, error } = await client
    .from("app_operations")
    .select("id, username, operation, statement, result, created_at, invoice_id")
    .eq("username", username)
    .eq("invoice_id", invoiceId)
    .order("created_at", { ascending:true });

  if(error){
    console.error(error);
    alert("خطأ فتح الفاتورة: " + error.message);
    return;
  }

  renderOps(data || []);

  // اجلب مجموع الفاتورة من جدول الفواتير (أضمن)
  const inv = await client
    .from("app_invoices")
    .select("total, created_at")
    .eq("id", invoiceId)
    .maybeSingle();

  const total = safeNum(inv.data?.total);
  $("grandTotal").value = String(total);

  vibrate(15);
}

function renderOps(ops){
  const tb = $("opsTbody");
  tb.innerHTML = "";
  (ops || []).forEach(o=>{
    const tr = document.createElement("tr");
    const tdT = document.createElement("td"); tdT.textContent = fmtDateTime(o.created_at);
    const tdS = document.createElement("td"); tdS.textContent = o.statement || "";
    const tdO = document.createElement("td"); tdO.textContent = o.operation || "";
    const tdR = document.createElement("td"); tdR.textContent = String(o.result ?? "");
    tr.append(tdT, tdS, tdO, tdR);
    tb.appendChild(tr);
  });
}

async function deleteSelectedInvoice(){
  if(!client) return;

  const username = requireUser();
  if(!username) return;

  const invoiceId = requireInvoice();
  if(!invoiceId) return;

  if(!confirm("تأكيد حذف الفاتورة المختارة؟ (سيحذف العمليات تلقائياً إذا FK موجود)")) return;

  const { error } = await client
    .from("app_invoices")
    .delete()
    .eq("id", invoiceId)
    .eq("username", username);

  if(error){
    console.error(error);
    alert("خطأ حذف الفاتورة: " + error.message);
    return;
  }

  alert("تم حذف الفاتورة ✅");
  $("invoiceSelect").value = "";
  $("opsTbody").innerHTML = "";
  $("grandTotal").value = "0";
  vibrate(25);
  await loadInvoicesForUser();
}

async function exportPdf(){
  const username = $("userSelect").value || "";
  const invoiceOpt = $("invoiceSelect").selectedOptions?.[0]?.textContent || "";
  const total = $("grandTotal").value;

  // جهّز printable
  const area = $("printable-area");
  $("printMeta").textContent = `المستخدم: ${username} | ${invoiceOpt}`;
  $("printTotal").textContent = `المجموع: ${total}`;

  // انسخ الجدول
  const htmlTable = `
    <table>
      <thead>
        <tr>
          <th>الوقت</th>
          <th>البيان</th>
          <th>العملية</th>
          <th>النتيجة</th>
        </tr>
      </thead>
      <tbody>
        ${Array.from($("opsTbody").querySelectorAll("tr")).map(tr=>{
          const tds = tr.querySelectorAll("td");
          return `<tr>
            <td>${tds[0]?.textContent||""}</td>
            <td>${tds[1]?.textContent||""}</td>
            <td>${tds[2]?.textContent||""}</td>
            <td>${tds[3]?.textContent||""}</td>
          </tr>`;
        }).join("")}
      </tbody>
    </table>
  `;
  $("printTable").innerHTML = htmlTable;
  area.style.display = "block";

  try{
    const opt = {
      margin: 10,
      filename: `invoice_${username}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
    await html2pdf().set(opt).from(area).save();
  }catch(e){
    console.error(e);
    alert("فشل تصدير PDF. جرّب متصفح Chrome.");
  }finally{
    area.style.display = "none";
  }
}

/* =======================
   UI events
   ======================= */
$("btnGenPass").onclick = genPassword;
$("btnSaveUser").onclick = addUser;
$("btnRefreshUsers").onclick = () => { state.usersPage = 0; loadUsers(); };

$("btnPrevUsers").onclick = () => { state.usersPage = Math.max(0, state.usersPage - 1); loadUsers(); };
$("btnNextUsers").onclick = () => { state.usersPage += 1; loadUsers(); };

$("searchUser").addEventListener("input", () => { state.usersPage = 0; loadUsers(); });

$("userSelect").addEventListener("change", async () => {
  $("invoiceSelect").innerHTML = `<option value="">— اختر فاتورة —</option>`;
  $("opsTbody").innerHTML = "";
  $("grandTotal").value = "0";
  if($("userSelect").value) await loadInvoicesForUser();
});

$("btnInvoicesRefresh").onclick = loadInvoicesForUser;
$("btnOpenInvoice").onclick = openSelectedInvoice;
$("btnDeleteInvoice").onclick = deleteSelectedInvoice;
$("btnPrintPdf").onclick = exportPdf;

$("btnToday").onclick = () => {
  const d = nowISODate();
  $("fromDate").value = d;
  $("toDate").value = d;
  loadInvoicesForUser();
};
$("btnLast7").onclick = () => {
  $("fromDate").value = daysAgoISO(7);
  $("toDate").value = nowISODate();
  loadInvoicesForUser();
};
$("btnClearDates").onclick = () => {
  $("fromDate").value = "";
  $("toDate").value = "";
  loadInvoicesForUser();
};

/* =======================
   Boot
   ======================= */
initClient();
loadUsers();
</script>

</body>
</html>
